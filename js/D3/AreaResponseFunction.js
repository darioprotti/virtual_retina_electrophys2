function selectCellType(){choice=select.value,"CellA"===choice?(Rc=62,Rs=179.8,cont=Rmax*Math.pow(contrast,3.9)/(Math.pow(contrast,3.9)+Math.pow(Hmax,3.9)),nrSpikesPerInt1=nrSpikesPerIntMagno):"CellB"===choice?(Rc=62,Rs=179.8,Rlin=cont,nrSpikesPerInt1=nrSpikesPerIntParvo):(Rc=Rc1,Rs=Rs1)}function selectCondition(){choiceD=selectC.value,"DrugA"===choiceD?(Kc=Kc1/1.072,Ks=Ks1/2):"DrugB"===choiceD?(Kc=1.017*Kc1,Ks=1.603*Ks1):(Kc=Kc1,Ks=Ks1)}var maxTime=1e3,spontaneous=7,currRadians=0,currAngle=0,currContrast=100,radius=200,SpotScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[0,20,40,60,80,100],colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1;nrSpikesPerInt1=[""];var Kc=64,Ks=37,Rc=62,Rs=179.8;Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8];var cont=[""],Hmax=15,Rmax=100,RNakaRushton=Rmax*Math.pow(contrast,3.9)/(Math.pow(contrast,3.9)+Math.pow(Hmax,3.9)),Rlin=contrast/Rmax*100,stimulusGroup;nrSpikesPerInt1=[""],nrSpikesPerIntMagno=[.1618,.2504,.332,.3384,.3651,.3876,.408,.4274,.4463,.465,.4835,.502,.5205,.5389,.5574,.5758,.5943,.6127,.6312,.6496,.668,.6865,.7049,.7234,.7418,.7603,.7787,.7971,.8156,.834,.8525,.8709,.8893,.9078,.9262,.9447,.9631,.9816],nrSpikesPerIntParvo=[.0503,.0937,.1318,.166,.1974,.2266,.2541,.2805,.306,.3308,.3552,.3791,.4028,.4263,.4496,.4728,.4959,.519,.542,.565,.588,.6109,.6338,.6567,.6796,.7025,.7254,.7483,.7712,.7941,.817,.8398,.8627,.8856,.9085,.9314,.9542,.9771],ChrSTabOn="",$("#ARTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),DSTabOn="",ChrSTabOn=""});var prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1,select=document.querySelector("select");select.addEventListener("change",selectCellType),choiceD="Control";var selectC=document.querySelector("#condition");selectC.addEventListener("change",selectCondition),$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#startStim1").on("click",function(){function e(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}for(var a,r=document.getElementById("RadioGroup3_0").value,n=document.getElementsByName("choice"),o=0;o<n.length;o++)n[o].checked&&(a=n[o].value);for(var o=(r.split(","),0);o<n.length;o++)n[o].checked&&(a=n[o].value);var o,i=[a],c=[""];c=Kc*e(Math.pow(i/Rc,2))-Ks*e(Math.pow(i/Rs,2)),currContrast=100;var s=poisson(currContrast/100*c+spontaneous);0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var l=visualSpikes.generateSpikeTimes(s,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(l),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select("#circleSpot").attr("r",0),d3.select(".userData").append("circle").attr("class","data"+contrast.indexOf(currContrast)).attr("cx",ARtunCurve.SpotScale(600-(600-i)%600)).attr("cy",ARtunCurve.firingScale(s)).attr("r",4).attr("fill",colors[currContrast/20]).attr("fill-opacity",.4).attr("stroke","darkgrey"),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(l),audioObj.playBuffer()),grating=["Spot0.png"],d3.select("#grating").attr("xlink:href","img/visual/Spot00.png").transition().duration(1).ease("easeinExpo").attr({x:-460,y:-240}),d3.select("#circleSpot").attr("r",i/4).style("fill","white").transition().duration(1).delay(function(t,e){return 100*e}).transition().duration(500).style("fill","white")}),$("#downloadDataAR").on("click",function(){downloadVisualDataAR(maxTime)}),$("#clearData").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearData(maxRate1,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});