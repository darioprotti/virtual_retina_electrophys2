function selectCondition(){var e=select.value;"DrugA"===e?(Kc=Kc1/1.072,Ks=Ks1/2):"DrugB"===e?(Kc=1.017*Kc1,Ks=1.603*Ks1):(Kc=Kc1,Ks=Ks1)}var maxTime=1e3,spontaneousRate=7,currRadians=0,currAngle=0,currContrast=100,currContrast=100,radius=200,SpotScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[0,20,40,60,80,100],colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1,Kc=64,Ks=37,Rc=62,Rs=179.8,axisvalue1=["Achr","ML","S"];Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8],currColour=10*Number($("#colour").val()),axisvalue=110;var cont=[""],Hmax=15,Rmax=100,RNakaRushton=Rmax*Math.pow(contrast,3.9)/(Math.pow(contrast,3.9)+Math.pow(Hmax,3.9)),Rlin=contrast/Rmax*100,choice,prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1;$("#ChrSTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),selectcolour=document.getElementById("colour").value,$("select#colour").val("0"),colour.setAttribute("value","0"),DSTabOn="",ChrSTab="",ChrSTabOn="ON"}),currColour=10*Number($("#colour").val()),"CellA"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellB"===choice&&250!=currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8,Rlin=cont):"CellC"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellC"===choice&&100!==currColour&&(Kc=1,Ks=1,Rc=62,Rs=179.8);var select=document.querySelector("select");select.addEventListener("change",selectCondition),$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#colour").on("change",function(){currColour=10*Number($("#colour").val()),100===currColour?axisvalue=110:150==currColour?axisvalue=[215]:axisvalue=[320],d3.select("#circleSpot").attr("r",0),d3.select("#grating").attr("xlink:href","img/visual/grating"+currColour+".png").attr({x:-780,y:-240}).attr("transform","rotate(0,0, 0)")}),$("#startStim3").on("click",function(){function e(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}var a=document.querySelector("select");a.addEventListener("change",selectCellType),"CellA"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellB"===choice&&250!=currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8,Rlin=cont):"CellC"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellC"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):"CellA"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):(Kc=1,Ks=1);for(var r,o=document.getElementById("RadioGroup3_0").value,c=document.getElementsByName("choice"),i=0;i<c.length;i++)c[i].checked&&(r=c[i].value);for(var i=(o.split(","),0);i<c.length;i++)c[i].checked&&(r=c[i].value);var i,l=[""],s=80;l=Kc*e(Math.pow(s/Rc,2))-Ks*e(Math.pow(s/Rs,2));var n=poisson(currContrast/100*l+spontaneous);0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var u=visualSpikes.generateSpikeTimes(n,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(u),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),grating=["Spot"+s+".png"],d3.select("#grating").transition().duration(1).ease("easeInExpo").attr({x:-780,y:-240}),d3.select(".userData3").append("circle").attr("class","data"+contrast.indexOf(currContrast)).attr("cx",axisvalue).attr("cy",CStunCurve.firingScale(n)).attr("r",4).attr("fill",colors[currContrast/20]).attr("fill-opacity",.4).attr("stroke","darkgrey"),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(u),audioObj.playBuffer()),d3.select("#grating").transition().duration(1e3).ease("easeInExpo").attr({x:-240,y:-240}),Kc=[64],Ks=[37]}),$("#downloadDataCS").on("click",function(){downloadVisualDataCS(maxTime)}),$("#clearData3").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearData3(maxRate1,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});