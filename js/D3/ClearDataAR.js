function clearData(e,o){$("div#ARTuningCurveGraph").html(""),$(".spikeData").remove(),ARtunCurveDomain=[-10,650],ARtunCurve=new TuningCurve0({width:540,height:400},ARtunCurveDomain,e),ARtunCurve.makeARTuningCurveGraph("div#ARTuningCurveGraph","Spot Size (Âµm)")}function poisson(e){for(var o=0,t=Math.exp(-e),n=Math.random();n>t;)o++,n*=Math.random();return o}function average(e){var o=e.reduce(function(e,o){return e+o},0),t=o/e.length;return t}function standardDeviation(e){var o=average(e),t=e.map(function(e){var t=e-o,n=t*t;return n}),n=average(t),a=Math.sqrt(n);return a}function downloadVisualDataAR(e){function o(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}var n=Number($("#nrRepeatsAR").val()),a="3";if(SpotsToProbe=SpotSizesDown,downloadSpikes=new SpikeVisualization({width:0,height:0},e),"1"==a)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var i=[],r=[],s=[],u=[],h=[],d=[],l=[],c=[];DrugConditionM=[],spikeCountsTheseParams=[],DrugCondition="Control"===choiceD?["Control"]:"DrugA"==choiceD?["Drug A"]:"DrugB"==choiceD?["Drug B"]:["Control"];for(var f=0;f<1;f++)for(var v=100,g=0;g<SpotsToProbe.length;g++){Math.PI*SpotsToProbe[g]/180;h.push([SpotsToProbe[g],v]),spikeCountsTheseParams=[];for(var m=0;m<n;m++)0===v?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,m<n/2?(c.push(0),thisMysteryGain=1):(c.push(1),thisMysteryGain=mysteryGain),d.push(Math.round(SpotsToProbe[g])),l.push(v),DrugConditionM.push(DrugCondition),DoG=Kc*o(Math.pow(SpotsToProbe[g]/Rc,2))-Ks*o(Math.pow(SpotsToProbe[g]/Rs,2)),nrSpikesThisTrial=poisson(v/100*DoG+spontaneous),spikeCountsTheseParams.push(nrSpikesThisTrial),r.push(nrSpikesThisTrial),i.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,e-1],thisAdaptationExp).sort(function(e,o){return e-o}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}var S,C,D,T="",k=[];switch(a){case"2":for(D="MeanAndSTD",T="Number of trials,Direction,Contrast,Mean,Standard deviation",C=0;C<h.length;C++)k.push(n+","+h[C][0]+","+h[C][1]+","+s[C]+","+u[C]);break;case"3":for(D="SpikeCounts",T="Trial number,Spot Size,Contrast,Drug Condition, Spike counts",C=0;C<d.length;C++)k.push(d[C]+","+l[C]+", "+DrugConditionM[C]+", "+r[C]);k.forEach(function(e,o){k[o]=o+1+","+e});break;case"4":for(D="SpikeTimes",T="Trial number,Direction,Contrast,A,Spike times (ms)",C=0;C<d.length;C++)k.push(d[C]+","+l[C]+","+c[C]+","+i[C]);shuffle(k),k.forEach(function(e,o){k[o]=o+1+","+e})}var M=T+"\n";k.forEach(function(e){M+=e+"\n"}),S=randomSeed+" - "+D,downloadCsv(M,S)}}function shuffle(e){for(var o,t,n=e.length;n;)t=Math.floor(Math.random()*n--),o=e[n],e[n]=e[t],e[t]=o}function getRandomBetween(e,o){return e=Math.ceil(e),o=Math.floor(o),Math.floor(Math.random()*(o-e+1))+e}$(document).ready(function(){SpotSizesDown=[30,40,60,80,100,120,150,200,250,300,400,600],$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(e,o){var t=$(o.newHeader).index("h3");jQuery.inArray(t,available_indexes)==-1&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),e.preventDefault())}})});var DrugCondition=[""];