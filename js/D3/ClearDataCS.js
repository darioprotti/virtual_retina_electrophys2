function clearData3(o,e){$("div#CSTuningCurveGraph").html(""),$(".spikeData").remove(),CStunCurveDomain=[-10,650],CStunCurve=new TuningCurve3({width:540,height:400},CStunCurveDomain,o),CStunCurve.makeCSTuningCurveGraph("div#CSTuningCurveGraph","Chromatic properties")}function poisson(o){for(var e=0,t=Math.exp(-o),a=Math.random();a>t;)e++,a*=Math.random();return e}function average(o){var e=o.reduce(function(o,e){return o+e},0),t=e/o.length;return t}function standardDeviation(o){var e=average(o),t=o.map(function(o){var t=o-e,a=t*t;return a}),a=average(t),r=Math.sqrt(a);return r}function downloadVisualDataCS(o){function e(o){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(o)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-o*o),Math.sign(o)*y}var a=Number($("#nrRepeatsCS").val()),r="3";if(SpotsToProbe=SpotSizesDownCS,downloadSpikes=new SpikeVisualization({width:0,height:0},o),"1"==r)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var n=[],i=[],s=[],u=[],h=[],l=[],c=[],d=[];ColourConditionM=[],spikeCountsTheseParams=[],currColour=10*Number($("#colour").val());for(var C=0;1>C;C++){var f=100;"CellA"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellB"===choice&&250!=currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8,Rlin=cont):"CellC"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellC"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):"CellA"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):(Kc=1,Ks=1);for(var v=0;v<SpotsToProbe.length;v++){Math.PI*SpotsToProbe[v]/180;h.push([SpotsToProbe[v],f]),spikeCountsTheseParams=[];for(var m=0;a>m;m++)0===f?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,a/2>m?(d.push(0),thisMysteryGain=1):(d.push(1),thisMysteryGain=mysteryGain),l.push(Math.round(SpotsToProbe[v])),c.push(f),ColourConditionM.push(ColourCondition),DoG=Kc*e(Math.pow(SpotsToProbe[v]/Rc,2))-Ks*e(Math.pow(SpotsToProbe[v]/Rs,2)),nrSpikesThisTrial=poisson(f/100*DoG+offset),spikeCountsTheseParams.push(nrSpikesThisTrial),i.push(nrSpikesThisTrial),n.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,o-1],thisAdaptationExp).sort(function(o,e){return o-e}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}}var S,M,T,g="",k=[];switch(r){case"2":for(T="MeanAndSTD",g="Number of trials,Direction,Contrast,Mean,Standard deviation",M=0;M<h.length;M++)k.push(a+","+h[M][0]+","+h[M][1]+","+s[M]+","+u[M]);break;case"3":for(T="SpikeCounts",g="Trial number,Spot Size,Chromatic property,Spike counts",M=0;M<l.length;M++)k.push(l[M]+","+ColourConditionM[M]+","+i[M]);k.forEach(function(o,e){k[e]=e+1+","+o});break;case"4":for(T="SpikeTimes",g="Trial number,Direction,Chromatic property,A,Spike times (ms)",M=0;M<l.length;M++)k.push(l[M]+","+c[M]+","+d[M]+","+n[M]);shuffle(k),k.forEach(function(o,e){k[e]=e+1+","+o})}var b=g+"\n";k.forEach(function(o){b+=o+"\n"}),S=randomSeed+" - "+T,downloadCsv(b,S)}}function shuffle(o){for(var e,t,a=o.length;a;)t=Math.floor(Math.random()*a--),e=o[a],o[a]=o[t],o[t]=e}function getRandomBetween(o,e){return o=Math.ceil(o),e=Math.floor(e),Math.floor(Math.random()*(e-o+1))+o}$(document).ready(function(){function o(o){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(o)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-o*o),Math.sign(o)*y}SpotSizesDownCS=[80],contrastToProbe=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];for(var e=[],a=0;100>a;a++)e.push(poisson(64*o(Math.pow(80/62,2))-37*o(Math.pow(80/179.8,2)))+7);maxRate1=Math.max.apply(null,e),$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(o,e){var t=$(e.newHeader).index("h3");-1==jQuery.inArray(t,available_indexes)&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),o.preventDefault())}})});var ColourCondition=[""];