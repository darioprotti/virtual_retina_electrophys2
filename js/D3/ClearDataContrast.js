function clearDataCtst(t,a){$("div#ContrastTuningCurveGraph").html(""),$(".spikeData").remove(),ContrasttunCurveDomain=[0,100],ContrasttunCurve=new TuningCurve1({width:540,height:400},ContrasttunCurveDomain,t),ContrasttunCurve.makeContrastTuningCurveGraph("div#ContrastTuningCurveGraph","Contrast")}function poisson(t){for(var a=0,o=Math.exp(-t),e=Math.random();e>o;)a++,e*=Math.random();return a}function average(t){var a=t.reduce(function(t,a){return t+a},0),o=a/t.length;return o}function standardDeviation(t){var a=average(t),o=t.map(function(t){var o=t-a,e=o*o;return e}),e=average(o),n=Math.sqrt(e);return n}function downloadVisualDataCtst(a){function o(a){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(a)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-a*a),Math.sign(a)*y}var e=Number($("#nrRepeatsCtst").val()),n="3";if(SpotsToProbe=SpotSizesDownCtsts,downloadSpikes=new SpikeVisualization({width:0,height:0},a),"1"==n)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var r=[],i=[],s=[],u=[],h=[],l=[],d=[],c=[];spikeCountsTheseParams=[];for(var f=0;f<contrastToProbe.length;f++){var v=contrastToProbe[f];"CellA"===choice?cont=Rmax*Math.pow(v,3.9)/(Math.pow(v,3.9)+Math.pow(Hmax,3.9)):"CellB"===choice?cont=v/Rmax*100:(Hmax=25,cont=Rmax*Math.pow(v,3.9)/(Math.pow(v,3.9)+Math.pow(Hmax,3.9)));for(var m=0;m<SpotsToProbe.length;m++){Math.PI*SpotsToProbe[m]/180;h.push([SpotsToProbe[m],v]),spikeCountsTheseParams=[];for(var C=0;C<e;C++)0===v?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,C<e/2?(c.push(0),thisMysteryGain=1):(c.push(1),thisMysteryGain=mysteryGain),l.push(Math.round(SpotsToProbe[m])),d.push(v),DoG=(Kc*o(Math.pow(SpotsToProbe[m]/Rc,2))-Ks*o(Math.pow(SpotsToProbe[m]/Rs,2)))*(cont/100),nrSpikesThisTrial=poisson(DoG+spontaneous),spikeCountsTheseParams.push(nrSpikesThisTrial),i.push(nrSpikesThisTrial),r.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,a-1],thisAdaptationExp).sort(function(t,a){return t-a}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}}var T,S,w,M="",g=[];switch(n){case"2":for(w="MeanAndSTD",M="Number of trials,Direction,Contrast,Mean,Standard deviation",S=0;S<h.length;S++)g.push(e+","+h[S][0]+","+h[S][1]+","+s[S]+","+u[S]);break;case"3":for(w="SpikeCounts",M="Trial number,Spot Size,Contrast,Spike counts",S=0;S<l.length;S++)g.push(l[S]+","+d[S]+","+i[S]);g.forEach(function(t,a){g[a]=a+1+","+t});break;case"4":for(w="SpikeTimes",M="Trial number,Direction,Contrast,A,Spike times (ms)",S=0;S<l.length;S++)g.push(l[S]+","+d[S]+","+c[S]+","+r[S]);shuffle(g),g.forEach(function(t,a){g[a]=a+1+","+t})}var k=M+"\n";g.forEach(function(t){k+=t+"\n"}),T=randomSeed+" - "+w,downloadCsv(k,T)}}function shuffle(t){for(var a,o,e=t.length;e;)o=Math.floor(Math.random()*e--),a=t[e],t[e]=t[o],t[o]=a}function getRandomBetween(t,a){return t=Math.ceil(t),a=Math.floor(a),Math.floor(Math.random()*(a-t+1))+t}$(document).ready(function(){SpotSizesDownCtsts=[80],contrastToProbe=[1,3,5,10,15,20,30,40,50,60,70,80,90,100],$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(t,a){var o=$(a.newHeader).index("h3");jQuery.inArray(o,available_indexes)==-1&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),t.preventDefault())}})});