function clearData4(e,t){$("div#TRTuningCurveGraph").html(""),$(".spikeData").remove(),TRtunCurveDomain=[0,1e3],TRtunCurve=new TuningCurve4({width:540,height:400},TRtunCurveDomain,300),TRtunCurve.makeTRTuningCurveGraph("div#TRTuningCurveGraph","Time (ms)")}function poisson(e){for(var t=0,a=Math.exp(-e),n=Math.random();n>a;)t++,n*=Math.random();return t}function average(e){var t=e.reduce(function(e,t){return e+t},0),a=t/e.length;return a}function standardDeviation(e){var t=average(e),a=e.map(function(e){var a=e-t,n=a*a;return n}),n=average(a),o=Math.sqrt(n);return o}function downloadVisualDataTR(e){function a(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}var n=Number($("#nrRepeatsTR").val()),o="4";if(SpotsToProbe=SpotSizesDownTR,downloadSpikes=new SpikeVisualization({width:0,height:0},e),"1"==o)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var i=[],r=[],s=[],u=[],h=[],d=[],l=[],c=[];spikeCountsTheseParams=[];for(var f=0;f<1;f++)for(var v=100,T=0;T<SpotsToProbe.length;T++){Math.PI*SpotsToProbe[T]/180;h.push([SpotsToProbe[T],v]),spikeCountsTheseParams=[];for(var m=0;m<n;m++)0===v?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,m<n/2?(c.push(0),thisMysteryGain=1):(c.push(1),thisMysteryGain=mysteryGain),d.push(Math.round(SpotsToProbe[T])),l.push(v),DoG=Kc*a(Math.pow(SpotsToProbe[T]/Rc,2))-Ks*a(Math.pow(SpotsToProbe[T]/Rs,2)),nrSpikesThisTrial=poisson(v/100*DoG+spontaneous),spikeCountsTheseParams.push(nrSpikesThisTrial),r.push(nrSpikesThisTrial),i.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,e-1],thisAdaptationExp).sort(function(e,t){return e-t}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}var S,g,k,b="",w=[];switch(o){case"2":for(k="MeanAndSTD",b="Number of trials,Direction,Contrast,Mean,Standard deviation",g=0;g<h.length;g++)w.push(n+","+h[g][0]+","+h[g][1]+","+s[g]+","+u[g]);break;case"3":for(k="SpikeCounts",b="Trial number,Spot Size,Contrast,A,Spike counts",g=0;g<d.length;g++)w.push(d[g]+","+l[g]+","+c[g]+","+r[g]);w.forEach(function(e,t){w[t]=t+1+","+e});break;case"4":for(k="SpikeTimes",b="Trial number,Spot Size,Contrast,Spike times (ms)",g=0;g<d.length;g++)w.push(d[g]+","+l[g]+","+i[g]);w.forEach(function(e,t){w[t]=t+1+","+e})}var M=b+"\n";w.forEach(function(e){M+=e+"\n"}),S=randomSeed+" - "+k,downloadCsv(M,S)}}function shuffle(e){for(var t,a,n=e.length;n;)a=Math.floor(Math.random()*n--),t=e[n],e[n]=e[a],e[a]=t}function getRandomBetween(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}$(document).ready(function(){SpotSizesDownTR=[80],$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=$(t.newHeader).index("h3");jQuery.inArray(a,available_indexes)==-1&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),e.preventDefault())}})});