var maxTime=1e3,spontaneousRate=7,currRadians=0,currAngle=0,currContrast=100,radius=200,ContrastScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1;var Kc=64,Ks=37,Rc=62,Rs=179.8;Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8],$("#CSTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png").attr({x:-460,y:-240}),DSTabOn="",ChrSTabOn=""});var prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1,values=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];$("#slider1").change(function(){$("span").text(values[this.value])}),labels={categories:contrast,colors:colors,labelTitle:"Contrast",unit:"%",visible:!0},$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#startStim2").on("click",function(){function a(a){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(a)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-a*a),Math.sign(a)*y}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}for(var e=(document.getElementById("RadioGroup3_0").value,document.getElementsByName("choice")),o=0;o<e.length;o++)e[o].checked;for(var o=0;o<e.length;o++)e[o].checked;var o,i=80,r=[""],n=values[slider1.value];"CellA"===choice?(Rc=62,Rs=179.8,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9))):"CellB"===choice?cont=n/Rmax*100:(Hmax=25,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9)),Rc=Rc1,Rs=Rs1),RNakaRushton=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9)),Rlin=n/Rmax*100,d3.select("#grating").attr("xlink:href","img/visual/Spotc"+n+".png"),r=(Kc*a(Math.pow(i/Rc,2))-Ks*a(Math.pow(i/Rs,2)))*(cont/100);var s=poisson(currContrast/100*r+offset);0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var c=visualSpikes.generateSpikeTimes(s,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(c),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select(".userData2").append("circle").attr("class","data"+n).attr("cx",ContrasttunCurve.ContrastScale(100-(100-n)%100)).attr("cy",ContrasttunCurve.firingScale(s)).attr("r",4).attr("fill",colors[currContrast/20]).attr("fill-opacity",.4).attr("stroke","darkgrey"),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(c),audioObj.playBuffer()),d3.select("#grating").transition().duration(1e3).ease("easeInExpo").attr({x:-460,y:-240})}),$("#downloadDataCtst").on("click",function(){downloadVisualDataCtst(maxTime)}),$("#clearDataCtst").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearDataCtst(maxRate1,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});