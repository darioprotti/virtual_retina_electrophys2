function TuningCurve4(t,a,s){this.visSizes=t,this.xDomain=a,this.maxY=s,ContrastSizesTicks=[100,200,300,400,500,600,700,800,900,1e3],this.makeTRTuningCurveGraph=function(t,i,a){a||(a={top:10,right:50,bottom:50,left:60}),this.width=this.visSizes.width-a.left-a.right,this.height=this.visSizes.height-a.top-a.bottom,this.ContrastScale=d3.scale.linear().range([0,this.width]).domain(this.xDomain),this.firingScale=d3.scale.linear().range([this.height,0]).domain([0,s]);var e;e="undefined"!=typeof SpotSizes?d3.svg.axis().scale(this.ContrastScale).orient("bottom").tickValues(ContrastSizesTicks):d3.svg.axis().scale(this.ContrastScale).orient("bottom");var r=d3.svg.axis().scale(this.firingScale).orient("left").ticks(8);this.svg=d3.select(t).append("svg").attr("viewBox","0,0,"+(this.width+a.left+a.right)+","+(this.height+a.top+a.bottom)).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+a.left+","+a.top+")").attr("fill-opacity",1),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(e).append("text").attr("transform","translate("+this.width/2+",40)").attr("text-anchor","middle").text(i),this.svg.append("g").attr("class","y axis").call(r).append("text").attr("transform","translate(-40,"+this.height/2+") rotate(-90)").style("text-anchor","middle").text("Response rate (spikes/sec)"),this.svg.append("g").attr("class","userData4")},this.addTrials=function(t,a,s){var e=[-90,-75,-60,-45,-30,-15,0,15,30,45,60,75,90];for(j=0;j<e.length;j++)for(i=0;i<s;i++)nrSpikesThisTrial2=poisson(a.tuningFunction1(e[j])),thisTrial={x:e[j],y:nrSpikesThisTrial2/10,color:"hsl(180, 100%, 25%)",legendIx:NaN},this.addTrialToGraph(t,thisTrial)},this.fitTunCurve=function(t,i){var a=[];for(Spot=0;Spot<600;Spot++)a.push({Spot:Spot,rate:i.tuningFunction1(Spot)});x=this.ContrastScale,y=this.firingScale;var s=d3.svg.line().x(function(t){return x(t.Spot)}).y(function(t){return y(t.rate)});d3.select(t+" .userData4").append("path").attr("class","line").attr("d",s(a)).attr("stroke","hsl(180, 100%, 25%)").attr("fill","none").attr("stroke-width","4").attr("shape-rendering","crispEdges")},this.addDashedLine=function(t,i){d3.select(t+" .userData4").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.ContrastScale(i.log),y1:this.firingScale(0),x2:this.ContrastScale(i.log),y2:this.firingScale(i.ContrasttuningFunction(i.log))}),d3.select(t+" .userData4").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.ContrastScale(i.log),y1:this.firingScale(i.tuningFunction(i.log)),x2:this.ContrastScale(this.xDomain[0]),y2:this.firingScale(i.tuningFunction(i.log))})}}