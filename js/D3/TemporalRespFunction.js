var maxTime=1e3,spontaneousRate=7,currRadians=0,currAngle=0,currContrast=100,radius=200,ContrastScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1;var Kc=64,Ks=37,Rc=62,Rs=179.8;Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8],$("#TRTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select("#grating").attr({x:-460,y:-240}),DSTabOn="",ChrSTabOn=""});var prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1,values=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];labels={categories:contrast,colors:colors,labelTitle:"Contrast",unit:"%",visible:!0},$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#startStim4").on("click",function(){function a(a){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(a)),k=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-a*a),Math.sign(a)*k}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}for(var e=(document.getElementById("RadioGroup3_0").value,document.getElementsByName("choice")),r=0;r<e.length;r++)e[r].checked;for(var r=0;r<e.length;r++)e[r].checked;var r,i=80,o=[""],n=100,s="grey",l={top:10,right:50,bottom:50,left:60},c=540-l.left-l.right,d=400-l.top-l.bottom;"CellA"===choice?(Rc=62,Rs=179.8,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9))):"CellB"===choice?cont=n/Rmax*100:(Rc=Rc1,Rs=Rs1,Hmax=25,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9))),RNakaRushton=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9)),Rlin=n/Rmax*100,d3.select("#grating").attr("xlink:href","img/visual/Spot80.png"),o=(Kc*a(Math.pow(i/Rc,2))-Ks*a(Math.pow(i/Rs,2)))*(cont/100);d3.svg.axis().scale(R).orient("bottom");currAdaptationExp=1;var u=[""],g=15,m=0,f=d3.scale.linear().domain([m,g]).range([d3.rgb(s).brighter(),d3.rgb(s).darker()]),h=poisson(currContrast/100*o+spontaneous),x=visualSpikes.generateSpikeTimes(h,[10,maxTime-5],currAdaptationExp),b=d3.max(x),v=d3.min(x),R=d3.scale.linear().domain([v,b]).range([0,c]),k=d3.scale.linear().domain([0,g]).range([d,0]);u=d3.layout.histogram().bins(40)(x),0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var x=visualSpikes.generateSpikeTimes(h,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(x),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select("#circleSpot").attr("r",0);var t=d3.select(".userData4");d3.selectAll(".userData4").attr("width",c+l.left+l.right).attr("height",d+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")");var a=t.selectAll(".bar").data(u).enter().append("g").attr("class","bar").attr("transform",function(t){return"translate("+R(t.x)+","+k(t.y)+")"});a.append("rect").attr("x",1).attr("fill",colors[currContrast/20]).attr("fill-opacity",1).attr("width",R(u[0].dx)-R(0)-1).attr("height",function(t){return d-k(t.y)}).attr("fill",function(t){return f(t.y)}),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(x),audioObj.playBuffer()),grating=["Spot0.png"],d3.select("#grating").attr("xlink:href","img/visual/Spot00.png").transition().duration(1).ease("easeinExpo").attr({x:-460,y:-240}),d3.select("#circleSpot").attr("r",20).style("fill","white").transition().duration(1).delay(function(t,a){return 100*a}).transition().duration(500).style("fill","white")}),$("#downloadDataTR").on("click",function(){downloadVisualDataTR(maxTime)}),$("#clearData4").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearData4(300,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});