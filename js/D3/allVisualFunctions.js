function clearData(e,o){$("div#ARTuningCurveGraph").html(""),$(".spikeData").remove(),ARtunCurveDomain=[-10,650],ARtunCurve=new TuningCurve0({width:540,height:400},ARtunCurveDomain,e),ARtunCurve.makeARTuningCurveGraph("div#ARTuningCurveGraph","Spot Size (µm)")}function poisson(e){for(var o=0,t=Math.exp(-e),n=Math.random();n>t;)o++,n*=Math.random();return o}function average(e){var o=e.reduce(function(e,o){return e+o},0),t=o/e.length;return t}function standardDeviation(e){var o=average(e),t=e.map(function(e){var t=e-o,n=t*t;return n}),n=average(t),a=Math.sqrt(n);return a}function downloadVisualDataAR(e){function o(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}var n=Number($("#nrRepeatsAR").val()),a="3";if(SpotsToProbe=SpotSizesDown,downloadSpikes=new SpikeVisualization({width:0,height:0},e),"1"==a)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var i=[],r=[],s=[],u=[],h=[],d=[],l=[],c=[];DrugConditionM=[],spikeCountsTheseParams=[],DrugCondition="Control"===choiceD?["Control"]:"DrugA"==choiceD?["Drug A"]:"DrugB"==choiceD?["Drug B"]:["Control"];for(var f=0;1>f;f++)for(var v=100,g=0;g<SpotsToProbe.length;g++){Math.PI*SpotsToProbe[g]/180;h.push([SpotsToProbe[g],v]),spikeCountsTheseParams=[];for(var m=0;n>m;m++)0===v?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,n/2>m?(c.push(0),thisMysteryGain=1):(c.push(1),thisMysteryGain=mysteryGain),d.push(Math.round(SpotsToProbe[g])),l.push(v),DrugConditionM.push(DrugCondition),DoG=Kc*o(Math.pow(SpotsToProbe[g]/Rc,2))-Ks*o(Math.pow(SpotsToProbe[g]/Rs,2)),nrSpikesThisTrial=poisson(v/100*DoG+spontaneous),spikeCountsTheseParams.push(nrSpikesThisTrial),r.push(nrSpikesThisTrial),i.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,e-1],thisAdaptationExp).sort(function(e,o){return e-o}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}var S,C,D,T="",k=[];switch(a){case"2":for(D="MeanAndSTD",T="Number of trials,Direction,Contrast,Mean,Standard deviation",C=0;C<h.length;C++)k.push(n+","+h[C][0]+","+h[C][1]+","+s[C]+","+u[C]);break;case"3":for(D="SpikeCounts",T="Trial number,Spot Size,Contrast,Drug Condition, Spike counts",C=0;C<d.length;C++)k.push(d[C]+","+l[C]+", "+DrugConditionM[C]+", "+r[C]);k.forEach(function(e,o){k[o]=o+1+","+e});break;case"4":for(D="SpikeTimes",T="Trial number,Direction,Contrast,A,Spike times (ms)",C=0;C<d.length;C++)k.push(d[C]+","+l[C]+","+c[C]+","+i[C]);shuffle(k),k.forEach(function(e,o){k[o]=o+1+","+e})}var M=T+"\n";k.forEach(function(e){M+=e+"\n"}),S=randomSeed+" - "+D,downloadCsv(M,S)}}function shuffle(e){for(var o,t,n=e.length;n;)t=Math.floor(Math.random()*n--),o=e[n],e[n]=e[t],e[t]=o}function getRandomBetween(e,o){return e=Math.ceil(e),o=Math.floor(o),Math.floor(Math.random()*(o-e+1))+e}$(document).ready(function(){SpotSizesDown=[30,40,60,80,100,120,150,200,250,300,400,600],$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(e,o){var t=$(o.newHeader).index("h3");-1==jQuery.inArray(t,available_indexes)&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),e.preventDefault())}})});var DrugCondition=[""];
function clearData1(e,t){$("div#tuningCurveGraph").html(""),$(".spikeData").remove(),tunCurveDomain=[-15,345],tunCurve=new TuningCurve({width:540,height:400},tunCurveDomain,e),tunCurve.makeTuningCurveGraph("div#tuningCurveGraph","Direction (°)")}function changeDirection(e){currAngle=30*Math.round(e/30),currRadians=currAngle*Math.PI/180,d3.select("#grating").attr("transform","rotate("+currAngle+",0, 0)"),$(".spikeData").remove()}function vonMises(e,t,a){return Math.exp(a*Math.cos(e-t))/(2*Math.PI*besseli(a,0))}function poisson(e){for(var t=0,a=Math.exp(-e),n=Math.random();n>a;)t++,n*=Math.random();return t}function average(e){var t=e.reduce(function(e,t){return e+t},0),a=t/e.length;return a}function standardDeviation(e){var t=average(e),a=e.map(function(e){var a=e-t,n=a*a;return n}),n=average(a),r=Math.sqrt(n);return r}function makeStimScreen(e){var t=342,a=342;stimulusGroup=d3.select(e).append("svg").attr("viewBox","0,0,"+t+","+a).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+t/2+","+a/2+")"),stimulusGroup.append("clipPath").attr("id","clipCircle").append("circle").attr("r",150).attr("cx",0).attr("cy",0),stimulusGroup.append("image").attr("id","grating").attr("xlink:href","img/visual/grating0.png").attr("clip-path","url(#clipCircle)").attr("x",-460).attr("y",-240).attr("width",920).attr("height",480),stimulusGroup.append("circle").attr("id","circleSpot").attr("clip-path","url(#clipCircle)").attr("x",-460).attr("y",-240).attr("r",0).attr("width",920).attr("height",480).style("fill","purple")}function downloadCsv(e,t){var a=new Blob([e]);if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(a,t+".csv");else{var n=window.document.createElement("a");n.href=window.URL.createObjectURL(a,{type:"text/plain"}),n.download=t+".csv",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}function downloadVisualData(e){var t=Number($("#nrRepeats").val()),a=$("#typeData").val(),n=directions;if(downloadSpikes=new SpikeVisualization({width:0,height:0},e),"1"==a)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var r=[],i=[],o=[],s=[],l=[],u=[],d=[],c=[];spikeCountsTheseParams=[];for(var p=0;1>p;p++)for(var h=100,m=0;m<n.length;m++){var f=Math.PI*n[m]/180;l.push([n[m],h]),spikeCountsTheseParams=[];for(var v=0;t>v;v++)0===h?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,t/2>v?(c.push(0),thisMysteryGain=1):(c.push(1),thisMysteryGain=mysteryGain),u.push(Math.round(n[m])),d.push(h),nrSpikesThisTrial=poisson(thisMysteryGain*(h/100)*amplitude*vonMises(f,prefDirectionRad,kappa)+offset),spikeCountsTheseParams.push(nrSpikesThisTrial),i.push(nrSpikesThisTrial),r.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,e-1],thisAdaptationExp).sort(function(e,t){return e-t}));o.push(average(spikeCountsTheseParams)),s.push(standardDeviation(spikeCountsTheseParams))}a="3";var g,w,k,y="",M=[];switch(a){case"2":for(k="MeanAndSTD",y="Number of trials,Direction,Contrast,Mean,Standard deviation",w=0;w<l.length;w++)M.push(t+","+l[w][0]+","+l[w][1]+","+o[w]+","+s[w]);break;case"3":for(k="SpikeCounts",y="Trial number,Direction,Contrast,A,Spike counts",w=0;w<u.length;w++)M.push(u[w]+","+d[w]+","+c[w]+","+i[w]);M.forEach(function(e,t){M[t]=t+1+","+e});break;case"4":for(k="SpikeTimes",y="Trial number,Direction,Contrast,Spike times (ms)",w=0;w<u.length;w++)M.push(u[w]+","+d[w]+","+r[w]);M.forEach(function(e,t){M[t]=t+1+","+e})}var C=y+"\n";M.forEach(function(e){C+=e+"\n"}),g=randomSeed+" - "+k,downloadCsv(C,g)}}function shuffle(e){for(var t,a,n=e.length;n;)a=Math.floor(Math.random()*n--),t=e[n],e[n]=e[a],e[a]=t}function getRandomBetween(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}$(document).ready(function(){stimulusGroup,$("#submitSeed").on("click",function(){var e;if(randomSeed=$("#nameSeed").val().toUpperCase(),0===randomSeed.length)e=new Math.seedrandom,$("#initMessage").html("You are now recording from a random neuron.");else{if(" "===randomSeed[0]||" "===randomSeed[randomSeed.length-1])return void alert("The neuron ID cannot start or end with a white space. Please rename your neuron.");e=new Math.seedrandom(randomSeed),$("#initMessage").html('You are now recording from a neuron with ID: "'+randomSeed+'"')}available_indexes.push(1),available_indexes.push(4),prefDirectionAng=Math.round(360*e()),prefDirectionRad=Math.PI*prefDirectionAng/180;var t=document.querySelector("select");t.addEventListener("change",selectCellType1),"CellC"===choice?kappa=2.5*e()+.5:kappa=0,amplitude=150*e()+50,offset=20*e();for(var a=[],n=0;100>n;n++)a.push(poisson(amplitude*vonMises(prefDirectionRad,prefDirectionRad,kappa)+offset));maxRate=Math.max.apply(null,a),labels={categories:contrast,colors:colors,labelTitle:"Contrast",unit:"%",visible:!0},clearData1(maxRate,labels)}),$("#directionDial").knob({width:80,height:80,cursor:1,thickness:.5,angleOffset:90,angleArc:359,bgColor:"hsl(0,0%,10%)",fgColor:"hsl(0,0%,90%)",min:0,max:359,displayInput:!1,step:30,draw:function(){this.i.val((360-this.cv)%360)},change:function(e){changeDirection(e)}}),$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=$(t.newHeader).index("h3");-1==jQuery.inArray(a,available_indexes)&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),e.preventDefault())}})});
function selectCellType(){choice=select.value,"CellA"===choice?(Rc=62,Rs=179.8,cont=Rmax*Math.pow(contrast,3.9)/(Math.pow(contrast,3.9)+Math.pow(Hmax,3.9))):"CellB"===choice?(Rc=62,Rs=179.8,Rlin=cont):(Rc=Rc1,Rs=Rs1)}function selectCondition(){choiceD=selectC.value,"DrugA"===choiceD?(Kc=Kc1/1.072,Ks=Ks1/2):"DrugB"===choiceD?(Kc=1.017*Kc1,Ks=1.603*Ks1):(Kc=Kc1,Ks=Ks1)}const browser=window.browser||window.chrome;var maxTime=1e3,spontaneous=7,currRadians=0,currAngle=0,currContrast=100,radius=200,SpotScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[0,20,40,60,80,100],colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1;nrSpikesPerInt1=[""];var Kc=64,Ks=37,Rc=62,Rs=179.8;Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8];var cont=[""],Hmax=15,Rmax=100,RNakaRushton=Rmax*Math.pow(contrast,3.9)/(Math.pow(contrast,3.9)+Math.pow(Hmax,3.9)),Rlin=contrast/Rmax*100,stimulusGroup;nrSpikesPerInt1=[""],ChrSTabOn="";var select=document.querySelector("select");select.addEventListener("change",selectCellType),$("#ARTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),DSTabOn="",ChrSTabOn=""});var prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1;choiceD="Control";var selectC=document.querySelector("#condition");selectC.addEventListener("change",selectCondition),$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#startStim1").on("click",function(){function e(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}for(var a,o=document.getElementById("RadioGroup3_0").value,r=document.getElementsByName("choice"),i=0;i<r.length;i++)r[i].checked&&(a=r[i].value);for(var i=(o.split(","),0);i<r.length;i++)r[i].checked&&(a=r[i].value);var i,n=[a],c=[""];c=Kc*e(Math.pow(n/Rc,2))-Ks*e(Math.pow(n/Rs,2)),currContrast=100;var s=poisson(currContrast/100*c+spontaneous);0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var l=visualSpikes.generateSpikeTimes(s,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(l),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select("#circleSpot").attr("r",0),d3.select(".userData").append("circle").attr("class","data"+contrast.indexOf(currContrast)).attr("cx",ARtunCurve.SpotScale(600-(600-n)%600)).attr("cy",ARtunCurve.firingScale(s)).attr("r",4).attr("fill",colors[currContrast/20]).attr("fill-opacity",.4).attr("stroke","darkgrey"),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(l),audioObj.playBuffer()),grating=["Spot0.png"],d3.select("#grating").attr("xlink:href","img/visual/Spot00.png").transition().duration(1).ease("easeinExpo").attr({x:-460,y:-240}),d3.select("#circleSpot").attr("r",n/4).style("fill","white").transition().duration(1).delay(function(t,e){return 100*e}).transition().duration(500).style("fill","white")}),$("#downloadDataAR").on("click",function(){downloadVisualDataAR(maxTime)}),$("#clearData").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearData(maxRate1,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});
var maxTime=1e3,spontaneousRate=7,currRadians=0,currAngle=0,currContrast=100,radius=200,ContrastScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1;var Kc=64,Ks=37,Rc=62,Rs=179.8;Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8],$("#CSTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png").attr({x:-460,y:-240}),DSTabOn="",ChrSTabOn=""});var prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1,values=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];$("#slider1").change(function(){$("span").text(values[this.value])}),labels={categories:contrast,colors:colors,labelTitle:"Contrast",unit:"%",visible:!0},$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#startStim2").on("click",function(){function a(a){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(a)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-a*a),Math.sign(a)*y}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}for(var e=(document.getElementById("RadioGroup3_0").value,document.getElementsByName("choice")),o=0;o<e.length;o++)e[o].checked;for(var o=0;o<e.length;o++)e[o].checked;var o,i=80,r=[""],n=values[slider1.value];"CellA"===choice?(Rc=62,Rs=179.8,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9))):"CellB"===choice?cont=n/Rmax*100:(Hmax=25,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9)),Rc=Rc1,Rs=Rs1),RNakaRushton=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9)),Rlin=n/Rmax*100,d3.select("#grating").attr("xlink:href","img/visual/Spotc"+n+".png"),r=(Kc*a(Math.pow(i/Rc,2))-Ks*a(Math.pow(i/Rs,2)))*(cont/100);var s=poisson(currContrast/100*r+offset);0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var c=visualSpikes.generateSpikeTimes(s,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(c),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select(".userData2").append("circle").attr("class","data"+n).attr("cx",ContrasttunCurve.ContrastScale(100-(100-n)%100)).attr("cy",ContrasttunCurve.firingScale(s)).attr("r",4).attr("fill",colors[currContrast/20]).attr("fill-opacity",.4).attr("stroke","darkgrey"),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(c),audioObj.playBuffer()),d3.select("#grating").transition().duration(1e3).ease("easeInExpo").attr({x:-460,y:-240})}),$("#downloadDataCtst").on("click",function(){downloadVisualDataCtst(maxTime)}),$("#clearDataCtst").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearDataCtst(maxRate1,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});
function selectCondition(){var e=select.value;"DrugA"===e?(Kc=Kc1/1.072,Ks=Ks1/2):"DrugB"===e?(Kc=1.017*Kc1,Ks=1.603*Ks1):(Kc=Kc1,Ks=Ks1)}var maxTime=1e3,spontaneousRate=7,currRadians=0,currAngle=0,currContrast=100,currContrast=100,radius=200,SpotScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[0,20,40,60,80,100],colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1,Kc=64,Ks=37,Rc=62,Rs=179.8,axisvalue1=["Achr","ML","S"];Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8],currColour=10*Number($("#colour").val()),axisvalue=110;var cont=[""],Hmax=15,Rmax=100,RNakaRushton=Rmax*Math.pow(contrast,3.9)/(Math.pow(contrast,3.9)+Math.pow(Hmax,3.9)),Rlin=contrast/Rmax*100,choice,prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1;$("#ChrSTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),selectcolour=document.getElementById("colour").value,$("select#colour").val("0"),colour.setAttribute("value","0"),DSTabOn="",ChrSTab="",ChrSTabOn="ON"}),currColour=10*Number($("#colour").val()),"CellA"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellB"===choice&&250!=currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8,Rlin=cont):"CellC"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellC"===choice&&100!==currColour&&(Kc=1,Ks=1,Rc=62,Rs=179.8);var select=document.querySelector("select");select.addEventListener("change",selectCondition),$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#colour").on("change",function(){currColour=10*Number($("#colour").val()),100===currColour?axisvalue=110:150==currColour?axisvalue=[215]:axisvalue=[320],d3.select("#circleSpot").attr("r",0),d3.select("#grating").attr("xlink:href","img/visual/grating"+currColour+".png").attr({x:-780,y:-240}).attr("transform","rotate(0,0, 0)")}),$("#startStim3").on("click",function(){function e(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}var a=document.querySelector("select");a.addEventListener("change",selectCellType),"CellA"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellB"===choice&&250!=currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8,Rlin=cont):"CellC"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellC"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):"CellA"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):(Kc=1,Ks=1);for(var r,o=document.getElementById("RadioGroup3_0").value,c=document.getElementsByName("choice"),i=0;i<c.length;i++)c[i].checked&&(r=c[i].value);for(var i=(o.split(","),0);i<c.length;i++)c[i].checked&&(r=c[i].value);var i,l=[""],s=80;l=Kc*e(Math.pow(s/Rc,2))-Ks*e(Math.pow(s/Rs,2));var n=poisson(currContrast/100*l+spontaneous);0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var u=visualSpikes.generateSpikeTimes(n,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(u),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),grating=["Spot"+s+".png"],d3.select("#grating").transition().duration(1).ease("easeInExpo").attr({x:-780,y:-240}),d3.select(".userData3").append("circle").attr("class","data"+contrast.indexOf(currContrast)).attr("cx",axisvalue).attr("cy",CStunCurve.firingScale(n)).attr("r",4).attr("fill",colors[currContrast/20]).attr("fill-opacity",.4).attr("stroke","darkgrey"),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(u),audioObj.playBuffer()),d3.select("#grating").transition().duration(1e3).ease("easeInExpo").attr({x:-240,y:-240}),Kc=[64],Ks=[37]}),$("#downloadDataCS").on("click",function(){downloadVisualDataCS(maxTime)}),$("#clearData3").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearData3(maxRate1,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});
var maxTime=1e3,spontaneousRate=7,currRadians=0,currAngle=0,currContrast=100,radius=200,ContrastScale,firingScale,SpotSizes=[30,40,60,80,100,120,150,200,250,300,400,600],contrast=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1;var Kc=64,Ks=37,Rc=62,Rs=179.8;Kc1=[64],Ks1=[37],Rc1=[62],Rs1=[179.8],$("#TRTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select("#grating").attr({x:-460,y:-240}),DSTabOn="",ChrSTabOn=""});var prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate1,values=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];labels={categories:contrast,colors:colors,labelTitle:"Contrast",unit:"%",visible:!0},$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#startStim4").on("click",function(){function a(a){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(a)),k=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-a*a),Math.sign(a)*k}if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}for(var e=(document.getElementById("RadioGroup3_0").value,document.getElementsByName("choice")),r=0;r<e.length;r++)e[r].checked;for(var r=0;r<e.length;r++)e[r].checked;var r,i=80,o=[""],n=100,s="grey",l={top:10,right:50,bottom:50,left:60},c=540-l.left-l.right,d=400-l.top-l.bottom;"CellA"===choice?(Rc=62,Rs=179.8,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9))):"CellB"===choice?cont=n/Rmax*100:(Rc=Rc1,Rs=Rs1,Hmax=25,cont=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9))),RNakaRushton=Rmax*Math.pow(n,3.9)/(Math.pow(n,3.9)+Math.pow(Hmax,3.9)),Rlin=n/Rmax*100,d3.select("#grating").attr("xlink:href","img/visual/Spot80.png"),o=(Kc*a(Math.pow(i/Rc,2))-Ks*a(Math.pow(i/Rs,2)))*(cont/100);d3.svg.axis().scale(R).orient("bottom");currAdaptationExp=1;var u=[""],g=15,m=0,f=d3.scale.linear().domain([m,g]).range([d3.rgb(s).brighter(),d3.rgb(s).darker()]),h=poisson(currContrast/100*o+spontaneous),x=visualSpikes.generateSpikeTimes(h,[10,maxTime-5],currAdaptationExp),b=d3.max(x),v=d3.min(x),R=d3.scale.linear().domain([v,b]).range([0,c]),k=d3.scale.linear().domain([0,g]).range([d,0]);u=d3.layout.histogram().bins(40)(x),0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var x=visualSpikes.generateSpikeTimes(h,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(x),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),d3.select("#grating").attr("xlink:href","img/visual/Spot00.png"),d3.select("#circleSpot").attr("r",0);var t=d3.select(".userData4");d3.selectAll(".userData4").attr("width",c+l.left+l.right).attr("height",d+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")");var a=t.selectAll(".bar").data(u).enter().append("g").attr("class","bar").attr("transform",function(t){return"translate("+R(t.x)+","+k(t.y)+")"});a.append("rect").attr("x",1).attr("fill",colors[currContrast/20]).attr("fill-opacity",1).attr("width",R(u[0].dx)-R(0)-1).attr("height",function(t){return d-k(t.y)}).attr("fill",function(t){return f(t.y)}),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(x),audioObj.playBuffer()),grating=["Spot0.png"],d3.select("#grating").attr("xlink:href","img/visual/Spot00.png").transition().duration(1).ease("easeinExpo").attr({x:-460,y:-240}),d3.select("#circleSpot").attr("r",20).style("fill","white").transition().duration(1).delay(function(t,a){return 100*a}).transition().duration(500).style("fill","white")}),$("#downloadDataTR").on("click",function(){downloadVisualDataTR(maxTime)}),$("#clearData4").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearData4(300,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});
var maxTime=1e3,spontaneousRate=7,currRadians=0,currAngle=0,currContrast=100,radius=200,angleScale,firingScale,directions=[0,30,60,90,120,150,180,210,240,270,300,330],contrast=[0,20,40,60,80,100],colors=["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],nowBuffering,available_indexes=[-1,0],randomSeed,adaptationExp=1.5,mysteryGain=1.1,DSTabOn=[""],prefDirectionAng,prefDirectionRad,kappa,amplitude,offset,maxRate;makeStimScreen("div#stimulusMonitor"),visualSpikes=new SpikeVisualization({width:450,height:150},maxTime),visualSpikes.makeOscilloscope("div.oscilloscope"),$("#DSTab").on("click",function(){d3.select("#grating").attr("xlink:href","img/visual/grating100_orig.png").attr({x:-680,y:-240}),DSTabOn="ON",ChrSTabOn=""}),$(document).ready(function(){browserSupportsAudio&&(audioObj=new AudioSpikes(maxTime,1)),$("#contrast").on("change",function(){currContrast=10*Number($("#contrast").val()),d3.select("#grating").attr("xlink:href","img/visual/grating"+currContrast+".png")}),$("#startStim").on("click",function(){if(1===$(".spikeData").length){if(!$(".spikeData").attr("finished"))return;$(".spikeData").remove()}$("#knobDiv").append('<div id="knobCover" style="position:relative;width:144px;height:144px;top:-120px;"></div>');var a=5+poisson(currContrast/100*amplitude*vonMises(2*Math.PI-currRadians,prefDirectionRad,kappa)+offset);0===currContrast?currAdaptationExp=1:currAdaptationExp=adaptationExp;var t=visualSpikes.generateSpikeTimes(a,[10,maxTime-5],currAdaptationExp);visualSpikes.generateSpikeTrace(t),visualSpikes.addTraceToOscilloscope().each("end",function(){d3.select(".spikeData").attr("finished",!0),d3.select("#grating").transition().duration(1).ease("easeInExpo").attr({x:-680,y:-240}),d3.select(".userData1").append("circle").attr("class","data"+contrast.indexOf(currContrast)).attr("cx",tunCurve.angleScale((360-currAngle)%360)).attr("cy",tunCurve.firingScale(a)).attr("r",4).attr("fill",colors[currContrast/20]).attr("fill-opacity",.4).attr("stroke","darkgrey"),d3.select("#knobCover").remove()}),browserSupportsAudio&&(audioObj.addWhiteNoise(),audioObj.addSpikesToAudio(t),audioObj.playBuffer()),d3.select("#grating").transition().duration(1e3).ease("easeInExpo").attr({x:-240,y:-240})}),$("#downloadData").on("click",function(){downloadVisualData(maxTime)}),$("#clearData1").on("click",function(){$('<div title="Are you sure?">This will clear all of the data points that you have collected so far from the bottom right panel. </div>').dialog({modal:!0,buttons:{Confirm:function(){clearData1(maxRate,labels),$(this).dialog("destroy").remove()},Cancel:function(){$(this).dialog("destroy").remove()}},closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()}})})});
function clearDataCtst(t,a){$("div#ContrastTuningCurveGraph").html(""),$(".spikeData").remove(),ContrasttunCurveDomain=[0,100],ContrasttunCurve=new TuningCurve1({width:540,height:400},ContrasttunCurveDomain,t),ContrasttunCurve.makeContrastTuningCurveGraph("div#ContrastTuningCurveGraph","Contrast")}function poisson(t){for(var a=0,o=Math.exp(-t),e=Math.random();e>o;)a++,e*=Math.random();return a}function average(t){var a=t.reduce(function(t,a){return t+a},0),o=a/t.length;return o}function standardDeviation(t){var a=average(t),o=t.map(function(t){var o=t-a,e=o*o;return e}),e=average(o),n=Math.sqrt(e);return n}function downloadVisualDataCtst(a){function o(a){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(a)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-a*a),Math.sign(a)*y}var e=Number($("#nrRepeatsCtst").val()),n="3";if(SpotsToProbe=SpotSizesDownCtsts,downloadSpikes=new SpikeVisualization({width:0,height:0},a),"1"==n)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var r=[],i=[],s=[],u=[],h=[],l=[],d=[],c=[];spikeCountsTheseParams=[];for(var f=0;f<contrastToProbe.length;f++){var v=contrastToProbe[f];"CellA"===choice?cont=Rmax*Math.pow(v,3.9)/(Math.pow(v,3.9)+Math.pow(Hmax,3.9)):"CellB"===choice?cont=v/Rmax*100:(Hmax=25,cont=Rmax*Math.pow(v,3.9)/(Math.pow(v,3.9)+Math.pow(Hmax,3.9)));for(var m=0;m<SpotsToProbe.length;m++){Math.PI*SpotsToProbe[m]/180;h.push([SpotsToProbe[m],v]),spikeCountsTheseParams=[];for(var C=0;e>C;C++)0===v?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,e/2>C?(c.push(0),thisMysteryGain=1):(c.push(1),thisMysteryGain=mysteryGain),l.push(Math.round(SpotsToProbe[m])),d.push(v),DoG=(Kc*o(Math.pow(SpotsToProbe[m]/Rc,2))-Ks*o(Math.pow(SpotsToProbe[m]/Rs,2)))*(cont/100),nrSpikesThisTrial=poisson(DoG+spontaneous),spikeCountsTheseParams.push(nrSpikesThisTrial),i.push(nrSpikesThisTrial),r.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,a-1],thisAdaptationExp).sort(function(t,a){return t-a}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}}var T,S,w,M="",g=[];switch(n){case"2":for(w="MeanAndSTD",M="Number of trials,Direction,Contrast,Mean,Standard deviation",S=0;S<h.length;S++)g.push(e+","+h[S][0]+","+h[S][1]+","+s[S]+","+u[S]);break;case"3":for(w="SpikeCounts",M="Trial number,Spot Size,Contrast,Spike counts",S=0;S<l.length;S++)g.push(l[S]+","+d[S]+","+i[S]);g.forEach(function(t,a){g[a]=a+1+","+t});break;case"4":for(w="SpikeTimes",M="Trial number,Direction,Contrast,A,Spike times (ms)",S=0;S<l.length;S++)g.push(l[S]+","+d[S]+","+c[S]+","+r[S]);shuffle(g),g.forEach(function(t,a){g[a]=a+1+","+t})}var k=M+"\n";g.forEach(function(t){k+=t+"\n"}),T=randomSeed+" - "+w,downloadCsv(k,T)}}function shuffle(t){for(var a,o,e=t.length;e;)o=Math.floor(Math.random()*e--),a=t[e],t[e]=t[o],t[o]=a}function getRandomBetween(t,a){return t=Math.ceil(t),a=Math.floor(a),Math.floor(Math.random()*(a-t+1))+t}$(document).ready(function(){SpotSizesDownCtsts=[80],contrastToProbe=[1,3,5,10,15,20,30,40,50,60,70,80,90,100],$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(t,a){var o=$(a.newHeader).index("h3");-1==jQuery.inArray(o,available_indexes)&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),t.preventDefault())}})});
function clearData3(o,e){$("div#CSTuningCurveGraph").html(""),$(".spikeData").remove(),CStunCurveDomain=[-10,650],CStunCurve=new TuningCurve3({width:540,height:400},CStunCurveDomain,o),CStunCurve.makeCSTuningCurveGraph("div#CSTuningCurveGraph","Chromatic properties")}function poisson(o){for(var e=0,t=Math.exp(-o),a=Math.random();a>t;)e++,a*=Math.random();return e}function average(o){var e=o.reduce(function(o,e){return o+e},0),t=e/o.length;return t}function standardDeviation(o){var e=average(o),t=o.map(function(o){var t=o-e,a=t*t;return a}),a=average(t),r=Math.sqrt(a);return r}function downloadVisualDataCS(o){function e(o){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(o)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-o*o),Math.sign(o)*y}var a=Number($("#nrRepeatsCS").val()),r="3";if(SpotsToProbe=SpotSizesDownCS,downloadSpikes=new SpikeVisualization({width:0,height:0},o),"1"==r)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var n=[],i=[],s=[],u=[],h=[],l=[],c=[],d=[];ColourConditionM=[],spikeCountsTheseParams=[],currColour=10*Number($("#colour").val());for(var C=0;1>C;C++){var f=100;"CellA"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellB"===choice&&250!=currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8,Rlin=cont):"CellC"===choice&&100===currColour?(Kc=[64],Ks=[37],Rc=62,Rs=179.8):"CellC"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):"CellA"===choice&&100!==currColour?(Kc=1,Ks=1,Rc=62,Rs=179.8):(Kc=1,Ks=1);for(var v=0;v<SpotsToProbe.length;v++){Math.PI*SpotsToProbe[v]/180;h.push([SpotsToProbe[v],f]),spikeCountsTheseParams=[];for(var m=0;a>m;m++)0===f?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,a/2>m?(d.push(0),thisMysteryGain=1):(d.push(1),thisMysteryGain=mysteryGain),l.push(Math.round(SpotsToProbe[v])),c.push(f),ColourConditionM.push(ColourCondition),DoG=Kc*e(Math.pow(SpotsToProbe[v]/Rc,2))-Ks*e(Math.pow(SpotsToProbe[v]/Rs,2)),nrSpikesThisTrial=poisson(f/100*DoG+offset),spikeCountsTheseParams.push(nrSpikesThisTrial),i.push(nrSpikesThisTrial),n.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,o-1],thisAdaptationExp).sort(function(o,e){return o-e}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}}var S,M,T,g="",k=[];switch(r){case"2":for(T="MeanAndSTD",g="Number of trials,Direction,Contrast,Mean,Standard deviation",M=0;M<h.length;M++)k.push(a+","+h[M][0]+","+h[M][1]+","+s[M]+","+u[M]);break;case"3":for(T="SpikeCounts",g="Trial number,Spot Size,Chromatic property,Spike counts",M=0;M<l.length;M++)k.push(l[M]+","+ColourConditionM[M]+","+i[M]);k.forEach(function(o,e){k[e]=e+1+","+o});break;case"4":for(T="SpikeTimes",g="Trial number,Direction,Chromatic property,A,Spike times (ms)",M=0;M<l.length;M++)k.push(l[M]+","+c[M]+","+d[M]+","+n[M]);shuffle(k),k.forEach(function(o,e){k[e]=e+1+","+o})}var b=g+"\n";k.forEach(function(o){b+=o+"\n"}),S=randomSeed+" - "+T,downloadCsv(b,S)}}function shuffle(o){for(var e,t,a=o.length;a;)t=Math.floor(Math.random()*a--),e=o[a],o[a]=o[t],o[t]=e}function getRandomBetween(o,e){return o=Math.ceil(o),e=Math.floor(e),Math.floor(Math.random()*(e-o+1))+o}$(document).ready(function(){function o(o){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(o)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-o*o),Math.sign(o)*y}SpotSizesDownCS=[80],contrastToProbe=[1,3,5,10,15,20,30,40,50,60,70,80,90,100];for(var e=[],a=0;100>a;a++)e.push(poisson(64*o(Math.pow(80/62,2))-37*o(Math.pow(80/179.8,2)))+7);maxRate1=Math.max.apply(null,e),$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(o,e){var t=$(e.newHeader).index("h3");-1==jQuery.inArray(t,available_indexes)&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),o.preventDefault())}})});var ColourCondition=[""];
function clearData4(e,t){$("div#TRTuningCurveGraph").html(""),$(".spikeData").remove(),TRtunCurveDomain=[0,1e3],TRtunCurve=new TuningCurve4({width:540,height:400},TRtunCurveDomain,300),TRtunCurve.makeTRTuningCurveGraph("div#TRTuningCurveGraph","Time (ms)")}function poisson(e){for(var t=0,a=Math.exp(-e),n=Math.random();n>a;)t++,n*=Math.random();return t}function average(e){var t=e.reduce(function(e,t){return e+t},0),a=t/e.length;return a}function standardDeviation(e){var t=average(e),a=e.map(function(e){var a=e-t,n=a*a;return n}),n=average(a),o=Math.sqrt(n);return o}function downloadVisualDataTR(e){function a(e){return a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,t=1/(1+p*Math.abs(e)),y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-e*e),Math.sign(e)*y}var n=Number($("#nrRepeatsTR").val()),o="4";if(SpotsToProbe=SpotSizesDownTR,downloadSpikes=new SpikeVisualization({width:0,height:0},e),"1"==o)$('<div title="Counts or times?">Please select which type of data you would like to download: spike counts per trial, or spike times per trial. </div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}});else{var i=[],r=[],s=[],u=[],h=[],d=[],l=[],c=[];spikeCountsTheseParams=[];for(var f=0;1>f;f++)for(var v=100,T=0;T<SpotsToProbe.length;T++){Math.PI*SpotsToProbe[T]/180;h.push([SpotsToProbe[T],v]),spikeCountsTheseParams=[];for(var m=0;n>m;m++)0===v?thisAdaptationExp=1:thisAdaptationExp=adaptationExp,n/2>m?(c.push(0),thisMysteryGain=1):(c.push(1),thisMysteryGain=mysteryGain),d.push(Math.round(SpotsToProbe[T])),l.push(v),DoG=Kc*a(Math.pow(SpotsToProbe[T]/Rc,2))-Ks*a(Math.pow(SpotsToProbe[T]/Rs,2)),nrSpikesThisTrial=poisson(v/100*DoG+spontaneous),spikeCountsTheseParams.push(nrSpikesThisTrial),r.push(nrSpikesThisTrial),i.push(downloadSpikes.generateSpikeTimes(nrSpikesThisTrial,[1,e-1],thisAdaptationExp).sort(function(e,t){return e-t}));s.push(average(spikeCountsTheseParams)),u.push(standardDeviation(spikeCountsTheseParams))}var S,g,k,b="",w=[];switch(o){case"2":for(k="MeanAndSTD",b="Number of trials,Direction,Contrast,Mean,Standard deviation",g=0;g<h.length;g++)w.push(n+","+h[g][0]+","+h[g][1]+","+s[g]+","+u[g]);break;case"3":for(k="SpikeCounts",b="Trial number,Spot Size,Contrast,A,Spike counts",g=0;g<d.length;g++)w.push(d[g]+","+l[g]+","+c[g]+","+r[g]);w.forEach(function(e,t){w[t]=t+1+","+e});break;case"4":for(k="SpikeTimes",b="Trial number,Spot Size,Contrast,Spike times (ms)",g=0;g<d.length;g++)w.push(d[g]+","+l[g]+","+i[g]);w.forEach(function(e,t){w[t]=t+1+","+e})}var M=b+"\n";w.forEach(function(e){M+=e+"\n"}),S=randomSeed+" - "+k,downloadCsv(M,S)}}function shuffle(e){for(var t,a,n=e.length;n;)a=Math.floor(Math.random()*n--),t=e[n],e[n]=e[a],e[a]=t}function getRandomBetween(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}$(document).ready(function(){SpotSizesDownTR=[80],$("#accordion").accordion({collapsible:!0,heightStyle:"content",beforeActivate:function(e,t){var a=$(t.newHeader).index("h3");-1==jQuery.inArray(a,available_indexes)&&($('<div title="Initialise your neuron first"> Please initialise your neuron first in the "Instructions" tab. If you don\'t want to use your name, any string will do; or if you want a random neuron just leave the box blank and press the "Initialise neuron" button.</div>').dialog({modal:!0,close:function(){$(this).dialog("destroy").remove()}}),e.preventDefault())}})});
function TuningCurve0(t,s,a){this.visSizes=t,this.xDomain=s,this.maxY=a,SpotSizesTicks=[50,100,150,200,250,300,400,600],this.makeARTuningCurveGraph=function(t,i,s){s||(s={top:10,right:50,bottom:50,left:60}),this.width=this.visSizes.width-s.left-s.right,this.height=this.visSizes.height-s.top-s.bottom,this.SpotScale=d3.scale.linear().range([0,this.width]).domain(this.xDomain),this.firingScale=d3.scale.linear().range([this.height,0]).domain([0,a]);var e;e="undefined"!=typeof SpotSizes?d3.svg.axis().scale(this.SpotScale).orient("bottom").tickValues(SpotSizesTicks):d3.svg.axis().scale(this.SpotScale).orient("bottom");var r=d3.svg.axis().scale(this.firingScale).orient("left").ticks(8);this.svg=d3.select(t).append("svg").attr("viewBox","0,0,"+(this.width+s.left+s.right)+","+(this.height+s.top+s.bottom)).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+s.left+","+s.top+")"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(e).append("text").attr("transform","translate("+this.width/2+",40)").attr("text-anchor","middle").text(i),this.svg.append("g").attr("class","y axis").call(r).append("text").attr("transform","translate(-40,"+this.height/2+") rotate(-90)").style("text-anchor","middle").text("Number of spikes"),this.svg.append("g").attr("class","userData")},this.addTrials=function(t,s,a){var e=[-90,-75,-60,-45,-30,-15,0,15,30,45,60,75,90];for(j=0;j<e.length;j++)for(i=0;i<a;i++)nrSpikesThisTrial2=poisson(s.tuningFunction0(e[j])),thisTrial={x:e[j],y:nrSpikesThisTrial2,color:"hsl(180, 100%, 25%)",legendIx:NaN},this.addTrialToGraph(t,thisTrial)},this.fitTunCurve=function(t,i){var s=[];for(Spot=0;Spot<600;Spot++)s.push({Spot:Spot,rate:i.tuningFunction0(Spot)});x=this.SpotScale,y=this.firingScale;var a=d3.svg.line().x(function(t){return x(t.Spot)}).y(function(t){return y(t.rate)});d3.select(t+" .userData").append("path").attr("class","line").attr("d",a(s)).attr("stroke","hsl(180, 100%, 25%)").attr("fill","none").attr("stroke-width","4").attr("shape-rendering","crispEdges")},this.addDashedLine=function(t,i){d3.select(t+" .userData").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.SpotScale(i.log),y1:this.firingScale(0),x2:this.SpotScale(i.log),y2:this.firingScale(i.ARtuningFunction(i.log))}),d3.select(t+" .userData").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.SpotScale(i.log),y1:this.firingScale(i.tuningFunction(i.log)),x2:this.SpotScale(this.xDomain[0]),y2:this.firingScale(i.tuningFunction(i.log))})}}
function TuningCurve1(t,s,a){this.visSizes=t,this.xDomain=s,this.maxY=a,ContrastSizesTicks=[3,10,20,30,50,80,100],this.makeContrastTuningCurveGraph=function(t,i,s){s||(s={top:10,right:50,bottom:50,left:60}),this.width=this.visSizes.width-s.left-s.right,this.height=this.visSizes.height-s.top-s.bottom,this.ContrastScale=d3.scale.linear().range([0,this.width]).domain(this.xDomain),this.firingScale=d3.scale.linear().range([this.height,0]).domain([0,a]);var e;e="undefined"!=typeof SpotSizes?d3.svg.axis().scale(this.ContrastScale).orient("bottom").tickValues(ContrastSizesTicks):d3.svg.axis().scale(this.ContrastScale).orient("bottom");var r=d3.svg.axis().scale(this.firingScale).orient("left").ticks(8);this.svg=d3.select(t).append("svg").attr("viewBox","0,0,"+(this.width+s.left+s.right)+","+(this.height+s.top+s.bottom)).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+s.left+","+s.top+")"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(e).append("text").attr("transform","translate("+this.width/2+",40)").attr("text-anchor","middle").text(i),this.svg.append("g").attr("class","y axis").call(r).append("text").attr("transform","translate(-40,"+this.height/2+") rotate(-90)").style("text-anchor","middle").text("Number of spikes"),this.svg.append("g").attr("class","userData2")},this.addTrials=function(t,s,a){var e=[-90,-75,-60,-45,-30,-15,0,15,30,45,60,75,90];for(j=0;j<e.length;j++)for(i=0;i<a;i++)nrSpikesThisTrial2=poisson(s.tuningFunction1(e[j])),thisTrial={x:e[j],y:nrSpikesThisTrial2,color:"hsl(180, 100%, 25%)",legendIx:NaN},this.addTrialToGraph(t,thisTrial)},this.fitTunCurve=function(t,i){var s=[];for(Spot=0;Spot<600;Spot++)s.push({Spot:Spot,rate:i.tuningFunction1(Spot)});x=this.ContrastScale,y=this.firingScale;var a=d3.svg.line().x(function(t){return x(t.Spot)}).y(function(t){return y(t.rate)});d3.select(t+" .userData2").append("path").attr("class","line").attr("d",a(s)).attr("stroke","hsl(180, 100%, 25%)").attr("fill","none").attr("stroke-width","4").attr("shape-rendering","crispEdges")},this.addDashedLine=function(t,i){d3.select(t+" .userData2").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.ContrastScale(i.log),y1:this.firingScale(0),x2:this.ContrastScale(i.log),y2:this.firingScale(i.ContrasttuningFunction(i.log))}),d3.select(t+" .userData2").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.ContrastScale(i.log),y1:this.firingScale(i.tuningFunction(i.log)),x2:this.ContrastScale(this.xDomain[0]),y2:this.firingScale(i.tuningFunction(i.log))})}}
function TuningCurve3(t,s,a){this.visSizes=t,this.xDomain=s,this.maxY=a,SpotSizesTicks1=["Achr","ML","S"],this.makeCSTuningCurveGraph=function(t,i,s){s||(s={top:10,right:50,bottom:50,left:60}),this.width=this.visSizes.width-s.left-s.right,this.height=this.visSizes.height-s.top-s.bottom,this.SpotScale=d3.scaleBand().range([0,this.width]).domain(["","Achr","ML","S"]),this.firingScale=d3.scale.linear().range([this.height,0]).domain([0,a]);var e;e="undefined"!=typeof SpotSizes?d3.svg.axis().scale(this.SpotScale).orient("bottom").tickValues(SpotSizesTicks1):d3.svg.axis().scale(this.SpotScale).orient("bottom");var r=d3.svg.axis().scale(this.firingScale).orient("left").ticks(8);this.svg=d3.select(t).append("svg").attr("viewBox","0,0,"+(this.width+s.left+s.right)+","+(this.height+s.top+s.bottom)).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+s.left+","+s.top+")"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(e).append("text").attr("transform","translate("+this.width/2+",40)").attr("text-anchor","middle").text(i),this.svg.append("g").attr("class","y axis").call(r).append("text").attr("transform","translate(-40,"+this.height/2+") rotate(-90)").style("text-anchor","middle").text("Number of spikes"),this.svg.append("g").attr("class","userData3")},this.addTrials=function(t,s,a){var e=[-90,-75,-60,-45,-30,-15,0,15,30,45,60,75,90];for(j=0;j<e.length;j++)for(i=0;i<a;i++)nrSpikesThisTrial2=poisson(s.tuningFunction3(e[j])),thisTrial={x:e[j],y:nrSpikesThisTrial2,color:"hsl(180, 100%, 25%)",legendIx:NaN},this.addTrialToGraph(t,thisTrial)},this.fitTunCurve=function(t,i){var s=[];for(Spot=0;Spot<600;Spot++)s.push({Spot:Spot,rate:i.tuningFunction3(Spot)});x=this.SpotScale,y=this.firingScale;var a=d3.svg.line().x(function(t){return x(t.Spot)}).y(function(t){return y(t.rate)});d3.select(t+" .userData3").append("path").attr("class","line").attr("d",a(s)).attr("stroke","hsl(180, 100%, 25%)").attr("fill","none").attr("stroke-width","4").attr("shape-rendering","crispEdges")},this.addDashedLine=function(t,i){d3.select(t+" .userData3").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.SpotScale(i.log),y1:this.firingScale(0),x2:this.SpotScale(i.log),y2:this.firingScale(i.ARtuningFunction(i.log))}),d3.select(t+" .userData3").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.SpotScale(i.log),y1:this.firingScale(i.tuningFunction(i.log)),x2:this.SpotScale(this.xDomain[0]),y2:this.firingScale(i.tuningFunction(i.log))})}}
function TuningCurve4(t,a,s){this.visSizes=t,this.xDomain=a,this.maxY=s,ContrastSizesTicks=[100,200,300,400,500,600,700,800,900,1e3],this.makeTRTuningCurveGraph=function(t,i,a){a||(a={top:10,right:50,bottom:50,left:60}),this.width=this.visSizes.width-a.left-a.right,this.height=this.visSizes.height-a.top-a.bottom,this.ContrastScale=d3.scale.linear().range([0,this.width]).domain(this.xDomain),this.firingScale=d3.scale.linear().range([this.height,0]).domain([0,s]);var e;e="undefined"!=typeof SpotSizes?d3.svg.axis().scale(this.ContrastScale).orient("bottom").tickValues(ContrastSizesTicks):d3.svg.axis().scale(this.ContrastScale).orient("bottom");var r=d3.svg.axis().scale(this.firingScale).orient("left").ticks(8);this.svg=d3.select(t).append("svg").attr("viewBox","0,0,"+(this.width+a.left+a.right)+","+(this.height+a.top+a.bottom)).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+a.left+","+a.top+")").attr("fill-opacity",1),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(e).append("text").attr("transform","translate("+this.width/2+",40)").attr("text-anchor","middle").text(i),this.svg.append("g").attr("class","y axis").call(r).append("text").attr("transform","translate(-40,"+this.height/2+") rotate(-90)").style("text-anchor","middle").text("Frequency (Hz)"),this.svg.append("g").attr("class","userData4")},this.addTrials=function(t,a,s){var e=[-90,-75,-60,-45,-30,-15,0,15,30,45,60,75,90];for(j=0;j<e.length;j++)for(i=0;i<s;i++)nrSpikesThisTrial2=poisson(a.tuningFunction1(e[j])),thisTrial={x:e[j],y:nrSpikesThisTrial2/10,color:"hsl(180, 100%, 25%)",legendIx:NaN},this.addTrialToGraph(t,thisTrial)},this.fitTunCurve=function(t,i){var a=[];for(Spot=0;Spot<600;Spot++)a.push({Spot:Spot,rate:i.tuningFunction1(Spot)});x=this.ContrastScale,y=this.firingScale;var s=d3.svg.line().x(function(t){return x(t.Spot)}).y(function(t){return y(t.rate)});d3.select(t+" .userData4").append("path").attr("class","line").attr("d",s(a)).attr("stroke","hsl(180, 100%, 25%)").attr("fill","none").attr("stroke-width","4").attr("shape-rendering","crispEdges")},this.addDashedLine=function(t,i){d3.select(t+" .userData4").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.ContrastScale(i.log),y1:this.firingScale(0),x2:this.ContrastScale(i.log),y2:this.firingScale(i.ContrasttuningFunction(i.log))}),d3.select(t+" .userData4").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.ContrastScale(i.log),y1:this.firingScale(i.tuningFunction(i.log)),x2:this.ContrastScale(this.xDomain[0]),y2:this.firingScale(i.tuningFunction(i.log))})}}
function TuningCurve(t,a,e){this.visSizes=t,this.xDomain=a,this.maxY=e,this.makeTuningCurveGraph=function(t,a,i){i||(i={top:10,right:50,bottom:50,left:60}),this.width=this.visSizes.width-i.left-i.right,this.height=this.visSizes.height-i.top-i.bottom,this.angleScale=d3.scale.linear().range([0,this.width]).domain(this.xDomain),this.firingScale=d3.scale.linear().range([this.height,0]).domain([0,this.maxY]);var e;e="undefined"!=typeof directions?d3.svg.axis().scale(this.angleScale).orient("bottom").tickValues(directions):d3.svg.axis().scale(this.angleScale).orient("bottom");var s=d3.svg.axis().scale(this.firingScale).orient("left").ticks(8);this.svg=d3.select(t).append("svg").attr("viewBox","0,0,"+(this.width+i.left+i.right)+","+(this.height+i.top+i.bottom)).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+i.left+","+i.top+")"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(e).append("text").attr("transform","translate("+this.width/2+",40)").attr("text-anchor","middle").text(a),this.svg.append("g").attr("class","y axis").call(s).append("text").attr("transform","translate(-40,"+this.height/2+") rotate(-90)").style("text-anchor","middle").text("Number of spikes"),this.svg.append("g").attr("class","userData1")},this.addTrialToGraph=function(t,a){d3.select(t+" .userData1").append("circle").attr("class","data"+a.legendIx).attr("cx",this.angleScale(a.x)).attr("cy",this.firingScale(a.y)).attr("r",4).attr("fill",a.color).attr("fill-opacity",.4).attr("stroke","darkgrey")},this.addTrials=function(t,a,e){var s=[-90,-75,-60,-45,-30,-15,0,15,30,45,60,75,90];for(j=0;j<s.length;j++)for(i=0;i<e;i++)nrSpikesThisTrial=poisson(a.tuningFunction(s[j])),thisTrial={x:s[j],y:nrSpikesThisTrial,color:"hsl(180, 100%, 25%)",legendIx:NaN},this.addTrialToGraph(t,thisTrial)},this.fitTunCurve=function(t,a){var i=[];for(angle=-90;angle<90;angle++)i.push({angle:angle,rate:a.tuningFunction(angle)});x=this.angleScale,y=this.firingScale;var e=d3.svg.line().x(function(t){return x(t.angle)}).y(function(t){return y(t.rate)});d3.select(t+" .userData1").append("path").attr("class","line").attr("d",e(i)).attr("stroke","hsl(180, 100%, 25%)").attr("fill","none").attr("stroke-width","4").attr("shape-rendering","crispEdges")},this.addDashedLine=function(t,a){d3.select(t+" .userData1").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.angleScale(a.linear),y1:this.firingScale(0),x2:this.angleScale(a.linear),y2:this.firingScale(a.tuningFunction(a.linear))}),d3.select(t+" .userData1").append("line").attr("stroke","hsl(180, 100%, 25%)").style("stroke-dasharray","3, 3").attr("stroke-width","2").attr({x1:this.angleScale(a.log),y1:this.firingScale(a.tuningFunction(a.linear)),x2:this.angleScale(this.xDomain[0]),y2:this.firingScale(a.tuningFunction(a.linear))})}}